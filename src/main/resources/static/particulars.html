<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> 动态详情 </title>
    <link rel="stylesheet" href="css/particulars.css" type="text/css">
    <link rel = "stylesheet" href = "./css/main.css">
    <link rel="shortcut icon" href="./images/logo.png">

</head>
<body>
<!--导航条-->
<nav class="mainNav" style="z-index: 9">
    <div class="logo">

    </div>
    <div class="functions">
        <textarea class="search" placeholder="大家正在搜:真相奶茶"></textarea><img src="images/search.png" alt=""
                                                                          onclick="search()">
        <ul>
            <li><a href="person02.html">我要写走测试</a></li>
            <li><a href="home.html">首页</a></li>
            <li><a href="video.html">视频</a></li>
            <li><a href="mynote.html">关注</a></li>
            <li><a href="chatroom.html" onclick="function f() {
                document.getElementById('notices').innerText=0;
              document.getElementById('notices').style.display='none';
            }">聊天</a></li>
        </ul>
    </div>
    <div class="setting">
        <ul>
            <li class="setting-message">
                <!-- 下拉小三角 -->
                消息<p id="notices" style="display: none">0</p>
                <div class="setting-wrapper">
                    <!-- <div class="triangle"></div> -->
                    <ul class="drop-down-message">
                        <li><a href="javascript:;">@我的</a></li>
                        <li><a href="javascript:;">评论</a></li>
                        <li><a href="javascript:;">赞</a></li>
                        <li><a href="javascript:;">私信</a></li>
                        <li><a href="javascript:;">未关注人私信</a></li>
                        <li><a href="javascript:;">群通知</a></li>
                        <li class="last-mes"><a href="javascript:;">消息设置</a></li>
                    </ul>
                </div>
            </li>
            <li class="message-setting">
                设置
                <div class="message-wrapper">
                    <ul class="drop-down-setting">
                        <li><a href="javascript:;">账号设置</a></li>
                        <li><a href="javascript:;">会员中心</a></li>
                        <li><a href="javascript:;">V认证</a></li>
                        <li><a href="javascript:;">账号安全</a></li>
                        <li><a href="javascript:;">隐私设置</a></li>
                        <li><a href="javascript:;">屏蔽设置</a></li>
                        <li><a href="javascript:;">消息设置</a></li>
                        <li><a href="javascript:;">帮助中心</a></li>
                        <li><a href="javascript:;" class="out">退出</a></li>
                    </ul>
                </div>
            </li>
            <li>其他</li>
        </ul>
    </div>
</nav>
<!--内容大框架-->
<div class="content">

    <div class="main">
        <!--动态部分 左-->
        <div class="thing" id="thing">


            <div class="butt">

                <li><a href="#">收藏</a></li>
                <li><a href="#">转发</a></li>
                <li><a href="#">评论</a></li><!--onclick="f()"-->
                <!--<script  >-->
                <!--function f() {-->
                <!--// alert("弹出评论框");< img src="../images/head.png" >-->
                <!--document.getElementById("com").innerHTML=-->
                <!--"<img src='images/1.png' style='margin-left: 20px;margin-top: 10px;width: 40px;height: 40px;float: left'>" +-->
                <!--"<textarea name='com' style='margin-top: 5px;margin-left: 5px; width: 500px;height: 100px; line-height: 150%;padding: 10px'></textarea>"-->
                <!--+"<button onclick='f1()' style='margin: 5px;background-color: #eb7350;color: white;padding:3px 15px;'>评论</button>";-->


                <!--}-->
                <!--function f1() {-->
                <!--document.getElementById("hf").innerHTML=-->

                <!--"<div class=\"comment\">" +-->
                <!--"<img src='images/1.png' style='margin-left: 20px;margin-top: 10px;width: 40px;height: 40px;float: left'>" +-->
                <!--"<p>dasdadsadasd</p>"-->
                <!--+"<button onclick='com()' style='margin: 5px;background-color: #eb7350;color: white;padding:3px 15px;'>评论</button>"-->
                <!--+"</div>";-->


                <!--}-->
                <!--</script>-->
                <li><a href="#">点赞</a></li>

            </div>

            <!--评论部分-->

            <div id="com">
                <ul id="pn">
                    <li class="list0">

                        <div class="content">
                            <div class="comment-list" id="comment-list">

                                <!--                                <div class="comment" user="self">-->
                                <!--                                    <div class="comment-right">-->
                                <!--                                        <div class="comment-text"><span class="user">我：</span>看哭了留卡号吧</div>-->
                                <!--                                        <div class="comment-date">-->
                                <!--                                            <br>-->
                                <!--                                            02-14 24:00-->
                                <!--                                            <a class="comment-zan" href="javascript:;" total="0" my="0">赞</a>-->
                                <!--                                            <a class="comment-dele" href="javascript:;">删除</a>-->
                                <!--                                        </div>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                            </div>
                            <div class="hf">
                                <textarea type="text" id="text" class="hf-text" autocomplete="off" maxlength="100"
                                          placeholder="评论..." onblur="textOnblur(this)" name="root"
                                          onfocus=" textGetFocus(this)"> </textarea>
                                <button class="hf-btn" onclick="send(this)">评论</button>
                                <span class="hf-nub">0/100</span>
                            </div>
                        </div>
                    </li>

                </ul>
                <script type="text/javascript">
                    function textOnblur(obj) {
                        //
                        // if(obj.innerText.length==0){
                        //     // console.log("change className....")
                        //     obj.parentNode.className='hf';
                        //     obj.value ='评论…';
                        // }

                    }

                    function textGetFocus(obj) {
                        // console.log(obj.parentNode)
                        obj.parentNode.className = 'hf hf-on';
                        obj.value = obj.value == '评论…' ? '' : obj.value;
                    }

                </script>
            </div>

        </div>
        <!--该博主信息  右-->
        <div class="self">
            <a id="but3" href="#">Infos 认证 </a>
            <p style="font-size: 15px">昵称 </p>
            <br/>
            <p>🚪 行业类别 优秀博主 编辑 </p>
            <p>👉 简介： 好好学习 不熬夜</p>
            <br/>
            <a style="text-align: center; cursor: pointer;" href="#"> 更多 ＞</a>
        </div>
    </div>

    <!--底部-->
    <div class="foot">
        <p>Infos 客服 客服热线 8888-8888</p>

        <p>意见反馈 开放平台 商务合作</p>
        <p>Copyright@2020-2020 Infos 开发小组</p>
    </div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script>
    /**
     * 平论功能；
     *
     */
    var comment_replyId;
    var comment_user;
    var messageId = $.cookie("messageId")
    var userName = $.cookie("userName");
    onload = function () {
        // console.log("hello,world")

        // console.log(messageId)
        $.ajax({
            url: "message/getMessage",
            type: "POST",
            data: {messageId: messageId},
            success: function (data) {


                var user = data.data.user;
                var message = data.data.message;
                var commens = data.data.comments;

                var message1 = document.createElement("div");
                message1.className = "message";
                message1.innerHTML = " <div class=\"head\">\n" +
                    "                    <img src='" + user.userImg + "' class=\"round_icon\">\n" +
                    "                </div>\n" +
                    "                <div class=\"msg\">\n" +
                    "                    <div class=\"name\">\n" +
                    "\n" +
                    "                        <a id=\"but1\">" + user.userName + "</a>\n" +
                    "\n" +
                    "                        <a id=\"but2\">➕ 关注</a>\n" +
                    "                    </div>\n" +
                    "\n" +
                    "                    <div class=\"sub\">\n" +

                    "                       " + message.message.messageInfo + " <div id=\"mediaList\" style=\"width: 100%;height: 400px;display: block;float: left;background-color:red;\"></div>\n" +
                    "\n" +
                    "\n" +
                    "                    </div>\n" +
                    "                </div>"

                // console.log(message1)
                document.getElementById("thing").prepend(message1)

                // console.log(commens);
                for (var i = 0; i < commens.length; i++) {
                    var comment = document.createElement("div");
                    comment.className = "comment"
                    comment.user = "self";
                    comment.innerHTML = " <div class=\"comment-right\" id='" + commens[i].comment.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + commens[i].userName + ":</span>" + commens[i].comment.commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                            " + commens[i].comment.commentTime + "" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>回复</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>"
                    document.getElementById("comment-list").append(comment);

                }

            }
        })
    }

    function send(obj) {


        var textinput = obj.parentNode.children[0];
        var userId = $.cookie("userId");
        var commentInfo = textinput.value;
        var sendType = textinput.getAttribute("name");
        // console.log(sendType + ":sendtype")
        if (sendType == "root") {
            // console.log("root:....................")
            // console.log(userId);
            // console.log(messageId);
            // console.log(commentInfo);
            // console.log("....................")
            $.ajax({
                url: "comment/addComment",
                type: "post",
                data: {
                    userId: userId,
                    messageId: messageId,
                    commentInfo: commentInfo
                },
                dataType: "JSON",
                success: function (data) {
                    // console.log(data);
                    /**
                     * data:{
                     *     userName,commentId,commentTime
                     * }
                     * @type {string}
                     *
                     *
                     */

                    var div_comment = document.createElement("div");
                    div_comment.className = "comment"
                    div_comment.user = "self";
                    div_comment.innerHTML = "<div class=\"comment-right\" id='" + data.data.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":</span>" + commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                            " + data.data.commentTime + "" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>回复</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>"


                    document.getElementById("comment-list").append(div_comment);

                }

            })
        } else if (sendType == "son") {
            var replyInfo = $("#text").val();
            // console.log("userId:" + userId + "\ncomment_replyId:" + comment_replyId + "\nreplyInfo:" + replyInfo + "...........................")
            $.ajax({
                url: "reply/saveReply",
                type: "POST",
                data: {
                    userId: userId,
                    parentId: comment_replyId,
                    replyInfo: replyInfo,
                },
                success: function (data) {

                    if (comment_user.indexOf(':') > 0) {
                        comment_user = comment_user.substr(0, comment_user.indexOf(':'))
                    }

                    // console.log("comment_user:"+comment_user)
                    var reply = data.data;
                    // console.log(data)
                    var comment = "<div class=\"comment\" user=\"self\">\n" +
                        "                                    <div class=\"comment-right\" id='" + reply.replyId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":@回复" + comment_user + "</span>" + ':' + replyInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                           " + reply.replyTime + "\n" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>回复</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>";


                    /**
                     * 将生成的comment追加到 document.getElementById(comment_replyId)之后
                     */
                    $(comment).insertAfter($(document.getElementById(comment_replyId)));
                    document.getElementById("text").setAttribute("name", "root");
                    document.getElementById("text").innerText = "";


                },
                error: function (data) {
                    console.log(data)

                }
            })

        }


        // console.log("change className....")
        document.getElementById("text").parentNode.className = 'hf';
        document.getElementById("text").value = '评论…';


    }

    function reply(obj) {

        obj.onclick=null;
        document.getElementById("text").parentNode.className = 'hf hf-on';
        document.getElementById("text").value = document.getElementById("text").value == '评论…' ? '' : document.getElementById("text").value;
        document.getElementById("text").focus()
        comment_replyId = obj.parentNode.parentNode.id;

        // console.log("comment_replyId:" + comment_replyId)
        comment_user = obj.parentNode.parentNode.children[0].children[0].innerText;
        // comment_user = comment_user.substr(0, comment_user.indexOf(":"))

        $.ajax({
                url: "reply/getReplysById",
                data: {parentId: comment_replyId},
                type: "POST",
                success: function (data) {
                    // console.log(data)
                    var reples = data.data;
                    if (reples != "没有数据") {
                        for (var i = 0; i < reples.length; i++) {
                            var reply = reples[i];
                            var comment = "<div class=\"comment\" user=\"self\">\n" +
                                "                                    <div class=\"comment-right\"  id='" + reply.reply.replyId + "' >\n" +
                                "                                        <div class=\"comment-text\"><span class=\"user\">" + reply.userName + ":@回复" + reply.byUserName + "</span>" + ':' + reply.reply.replyInfo + "</div>\n" +
                                "                                        <div class=\"comment-date\">\n" +
                                "                                            <br>\n" +
                                "                                           " + reply.reply.replyTime + "\n" +
                                "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>回复</a>\n" +
                                "                                        </div>\n" +
                                "                                    </div>\n" +
                                "                                </div>";


                            /**
                             * 将生成的comment追加到 document.getElementById(comment_replyId)之后
                             */
                            $(comment).insertAfter($(document.getElementById(comment_replyId).parentNode));
                        }
                    }


                },
            }
        );


        var text = document.getElementById("text");
        text.setAttribute("name", "son");
        text.focus();

    }

    function guanzhu(userId) {

    }

</script>
</body>
</html>